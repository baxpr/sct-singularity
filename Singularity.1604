Bootstrap: docker
From: ubuntu:16.04


%post

  apt-get update

  # Workaround for filename issue: manpages-dev
  apt-get install -y binutils xz-utils manpages
  mkdir pkgtemp
  cd pkgtemp
  apt-get download manpages-dev
  ar x manpages-dev*deb
  tar xJf data.tar.xz
  tar cJf data.tar.xz ./usr
  ar rcs manpages-dev*.deb debian-binary control.tar.gz data.tar.xz
  dpkg -i manpages-dev*.deb
  cd ..
  rm -fr pkgtemp

  # Workaround for filename case collision in linux-libc-dev
  # https://superuser.com/questions/1238903/cant-install-linux-libc-dev-in-ubuntu-on-windows
  apt-get install -y binutils xz-utils
  mkdir pkgtemp
  cd pkgtemp
  apt-get download linux-libc-dev
  ar x linux-libc-dev*deb
  tar xJf data.tar.xz
  tar cJf data.tar.xz ./usr
  ar rcs linux-libc-dev*.deb debian-binary control.tar.gz data.tar.xz
  dpkg -i linux-libc-dev*.deb
  cd ..
  rm -fr pkgtemp

  # SCT installation
  apt-get install -y curl wget gcc git bzip2
  SCTVER=4.0.0-beta.5
  SCTDIR=/opt/sct-${SCTVER}
  git clone --branch ${SCTVER} --depth 1 https://github.com/neuropoly/spinalcordtoolbox.git ${SCTDIR}
  cd ${SCTDIR}
  ASK_REPORT_QUESTION=false change_default_path=Yes add_to_path=No ./install_sct
  
  
%environment
  PATH="${SCTDIR}/bin:${PATH}"


%runscript
  sct_check_dependencies "$@"
